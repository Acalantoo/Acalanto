<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="Estilo_Dash.css" />
    <script src="../JavaScript/Funcionalidade.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Acalanto - Meus Refrigeradores</title>
  </head>

  <body>
  <!-- <body onload="atualizacaoPeriodica()"> -->
    <div class="header">
      <div class="container">
        <div class="card_logo">
          <img src="../img/Logo_Acalanto_icon3.png" />

          <h2><a href="MeusRefrigeradores.html">Acalanto</a></h2>
        </div>
      
        <div class="card_perfil">
          <img src="../img/Logo_Acalanto_icon.png" />
          <h4 id="perfil"></h4>
        </div>

        <ul class="navbar">
          <li><a href="MeusRefrigeradores.html" class="agora">Refrigeradores</a></li>
          <hr>
          <li><a href="NovoUsuario.html">Novo Usuario</a></li>
          <hr>
          <li><a href="Relatorio.html">Relatório</a></li>
          <hr>
          <li><a href="graficos.html">Gráficos</a></li>
          <hr>
        </ul>
        <button onclick="limparSessao()" class="btn">Sair</button>
      </div>
    </div>

    <div class="banner">
      <div class="container">
        
        <div class="refrigeradores">
          
          <div class="card_refri">
            <p>Refrigerador 1</p>
            <div class="barra"></div>
            <div id="refrigerador1" class="temperatura_atual">
              0°
              <span class="bola"></span>
            </div>
          </div>

          <div class="card_refri">
            <p>Refrigerador 2</p>
            <div class="barra"></div>
            <div id="refrigerador2" class="temperatura_atual">
              0°
              <span class="bola"></span>
            </div>
          </div>

          <div class="card_refri">
            <p>Refrigerador 3</p>
            <div class="barra"></div>
            <div id="refrigerador3" class="temperatura_atual">
              0°
              <span class="bola"></span>
            </div>
          </div>

          <div class="card_refri">
            <p>Refrigerador 4</p>
            <div class="barra"></div>
            <div id="refrigerador4" class="temperatura_atual">
              0°
              <span class="bola"></span>
            </div>
          </div>

          <div class="card_grafico">
            <div>
              <canvas id="Chart_meus_refrigeradores"></canvas>
            </div>
          </div>

        </div>


        <div class="card_metricas">
          <div class="indicador I">
            Perigo Frio <span class="numero">-25°C</span>
          </div>
          <div class="indicador II">
            Alerta Frio <span class="numero">-22°C</span>
          </div>
          <div class="indicador III">
            Ideal <span class="numero">-20°C</span>
          </div>
          <div class="indicador IIII">
            Alerta Quente <span class="numero">-19°C</span>
          </div>
          <div class="indicador IIIII">
            Perigo Quente <span class="numero">-15°C</span>
          </div>
        </div>

      </div>
    </div>

  </body>
</html>

<script>
  const labels = [
    "1:00am",
    "6:00am",
    "9:00am",
    "12:00",
    "01:00pm",
    "04:00pm",
    "07:00pm",
    "10:00pm",
    "00:00pm",
  ];

  const data = {
    labels: labels,

    datasets: [
      {
        label: "Refrigerador 1",
        backgroundColor: "red",
        borderColor: "red",
        data: [-16, -18, -15, -22],
      },
      {
        label: "Refrigerador 2",
        backgroundColor: "blue",
        borderColor: "blue",
        data: [-20, -18, -16, -22],
      },
      {
        label: "Refrigerador 3",
        backgroundColor: "green",
        borderColor: "green",
        data: [-18, -19, -18, -20],
      },
      {
        label: "Refrigerador 4",
        backgroundColor: "purple",
        borderColor: "purple",
        data: [-19, -21, -19, -20],
      },
    ],
  };

  const config = {
    type: "line",
    data: data,
    options: {},
  };
</script>

<script>
  const Chart_meus_refrigeradores = new Chart(
    document.getElementById("Chart_meus_refrigeradores"),
    config
  );
</script>

<script>

  function atualizacaoPeriodica() {
      obterdados(1);
      obterdados(2);
      obterdados(3);
      obterdados(4);

      function sendData() {
    var http = new XMLHttpRequest();
    http.open('POST', 'http://localhost:3000/api/sendData', false);
    http.send(null);
  }

      setInterval(() => {
    sendData();
  }, 2000);
      setTimeout(atualizacaoPeriodica, 5000);
  }

  function obterdados(idAquario) {
      fetch(`/medidas/tempo-real/${idAquario}`)
          .then(resposta => {

              if (resposta.ok) {
                  resposta.json().then(resposta => {

                      console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);

                      var dados = {
                          temperatura: resposta[0].temperatura,
                      }

                      alertar(resposta[0].temperatura, idAquario);
                  });
              } else {

                  console.error('Nenhum dado encontrado ou erro na API');
              }
          })
          .catch(function (error) {
              console.error(`Erro na obtenção dos dados do aquario p/ gráfico: ${error.message}`);
          });

  }

  function alertar(temperatura, idAquario) {
      var limites = {
          muito_quente: -15,
          quente: -19,
          ideal: -20,
          frio: -22,
          muito_frio: -25
      };

      var classe_temperatura = 'cor-alerta';

      if (temperatura >= limites.muito_quente) {
          classe_temperatura = 'cor-alerta perigo-quente';
          console.log("caiu no 1")
      }
      else if (temperatura < limites.muito_quente && temperatura >= limites.quente) {
          classe_temperatura = 'cor-alerta alerta-quente';
          console.log("caiu no 2")
      }
      else if (temperatura < limites.quente && temperatura > limites.frio) {
          classe_temperatura = 'cor-alerta ideal';
          console.log("caiu no 3")
      }
      else if (temperatura <= limites.frio && temperatura > limites.muito_frio) {
          classe_temperatura = 'cor-alerta alerta-frio';
          console.log("caiu no 4")
      }
      else if (temperatura < limites.min_temperatura) {
          classe_temperatura = 'cor-alerta perigo-frio';
          console.log("caiu no 5")
      }

      var card;

      if (idAquario == 1) {
          refrigerador1.innerHTML = temperatura + "°C";
          // card = card_1;
      } else if (idAquario == 2) {
          refrigerador2.innerHTML = temperatura + "°C";
          // card = card_2
      } else if (idAquario == 3) {
          refrigerador3.innerHTML = temperatura + "°C";
          // card = card_3
      } else if (idAquario == 4) {
          refrigerador4.innerHTML = temperatura + "°C";
          // card = card_4
      }

      // alterando
      card.className = classe_temperatura;

  }

</script>